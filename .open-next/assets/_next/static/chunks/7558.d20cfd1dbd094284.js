"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7558],{35299:(e,a,t)=>{t.d(a,{V:()=>o});var l=t(95155),r=t(12115),i=t(73579),s=t(51368),n=t(31802);let o=e=>{let{bucket:a,onComplete:t,maxFiles:o=1,acceptedFileTypes:m=["image/jpeg","image/png","image/webp"]}=e,[d,c]=(0,r.useState)(!1),[u,f]=(0,r.useState)(0),p=(0,i.createClientComponentClient)(),g=(0,r.useCallback)(async e=>{try{if(!e.target.files||0===e.target.files.length)return;c(!0),f(0);let r=Array.from(e.target.files).slice(0,o);for(let[e,i]of r.entries()){var l;if(!m.includes(i.type)){alert("Skipping file ".concat(i.name,": Invalid file type ").concat(i.type));continue}let o=(null==(l=i.name.split(".").pop())?void 0:l.toLowerCase())||"";if(!["jpg","jpeg","png","webp"].includes(o)){alert("Skipping file ".concat(i.name,": Invalid extension ").concat(o));continue}let d=i,c=i,u="",g="";try{d=await (0,n.A)(i,{maxSizeMB:1,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/webp",initialQuality:.85}),u="".concat((0,s.A)(),".webp"),c=await (0,n.A)(i,{maxSizeMB:1,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/jpeg",initialQuality:.85}),g="".concat((0,s.A)(),".jpg")}catch(e){alert("Image optimization failed. Uploading original file."),u="".concat((0,s.A)(),".webp"),g="".concat((0,s.A)(),".jpg")}let x=setInterval(()=>{f(e=>Math.min(e+10,90))},100);try{let{error:l}=await p.storage.from(a).upload(u,d,{cacheControl:"3600",upsert:!0});if(l)throw l;let{error:i}=await p.storage.from(a).upload(g,c,{cacheControl:"3600",upsert:!0});if(i)throw i;f(100),t({webp:u,original:g}),e<r.length-1&&f(0)}catch(e){alert("Error uploading file: "+(e instanceof Error?e.message:JSON.stringify(e,null,2)))}finally{clearInterval(x)}}}catch(e){alert("Error in handleUpload: "+(e instanceof Error?e.message:JSON.stringify(e,null,2)))}finally{c(!1),f(0)}},[a,o,m,t,p]);return(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("input",{type:"file",onChange:g,accept:m.join(","),multiple:o>1,disabled:d,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary-light file:text-primary hover:file:bg-primary hover:file:text-white"}),d&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("div",{className:"h-2 bg-gray-200 rounded",children:(0,l.jsx)("div",{className:"h-2 bg-primary rounded transition-all duration-300",style:{width:"".concat(u,"%")}})}),(0,l.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Uploading... ",u,"%"]})]})]})}},67558:(e,a,t)=>{t.r(a),t.d(a,{default:()=>c});var l=t(95155),r=t(12115),i=t(62177),s=t(73579),n=t(26715),o=t(5041),m=t(51368),d=t(35299);function c(e){let{author:a,onClose:t}=e,[c,u]=(0,r.useState)(!1),[f,p]=(0,r.useState)(null==a?void 0:a.avatar_url),g=(0,s.createClientComponentClient)(),x=(0,n.jE)(),{control:b,handleSubmit:h,formState:{errors:y}}=(0,i.mN)({defaultValues:{full_name:(null==a?void 0:a.full_name)||"",email:(null==a?void 0:a.email)||"",bio:(null==a?void 0:a.bio)||"",avatar_url:(null==a?void 0:a.avatar_url)||""}}),j=(0,o.n)({mutationFn:async e=>{u(!0);try{if(null==a?void 0:a.id){let{error:t}=await g.from("blog_authors").update({full_name:e.full_name,email:e.email,bio:e.bio,avatar_url:f,updated_at:new Date().toISOString()}).eq("id",a.id);if(t)throw t;return{id:a.id}}{let a={id:(0,m.A)(),full_name:e.full_name,email:e.email,bio:e.bio,avatar_url:f},{error:t}=await g.from("blog_authors").insert(a);if(t)throw t;return a}}finally{u(!1)}},onSuccess:()=>{x.invalidateQueries({queryKey:["blog-authors"]}),t()}});return(0,l.jsxs)("form",{onSubmit:h(e=>{j.mutate({...e,avatar_url:f})}),className:"space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700",children:"Full Name *"}),(0,l.jsx)(i.xI,{name:"full_name",control:b,rules:{required:"Full name is required"},render:e=>{let{field:a}=e;return(0,l.jsx)("input",{...a,type:"text",id:"full_name",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"})}}),y.full_name&&(0,l.jsx)("p",{className:"mt-1 text-sm text-red-600",children:y.full_name.message})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),(0,l.jsx)(i.xI,{name:"email",control:b,render:e=>{let{field:a}=e;return(0,l.jsx)("input",{...a,type:"email",id:"email",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"})}})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Avatar"}),(0,l.jsxs)("div",{className:"mt-1",children:[(0,l.jsx)(d.V,{bucket:"blog-authors",onComplete:e=>p(e),maxFiles:1,acceptedFileTypes:["image/jpeg","image/png","image/webp"]}),f&&(0,l.jsx)("div",{className:"mt-2",children:(0,l.jsx)("img",{src:f,alt:"Author avatar",className:"h-20 w-20 rounded-full object-cover"})})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{htmlFor:"bio",className:"block text-sm font-medium text-gray-700",children:"Bio"}),(0,l.jsx)(i.xI,{name:"bio",control:b,render:e=>{let{field:a}=e;return(0,l.jsx)("textarea",{...a,id:"bio",rows:4,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm"})}})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,l.jsx)("button",{type:"button",onClick:t,className:"inline-flex justify-center rounded-md border border-gray-300 bg-white py-2 px-4 text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:"Cancel"}),(0,l.jsx)("button",{type:"submit",disabled:c,className:"inline-flex justify-center rounded-md border border-transparent bg-primary-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50",children:c?"Saving...":"Save Author"})]})]})}}}]);