(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9314],{11684:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(95155),n=r(12115),i=r(26715),a=r(19373),d=r(5041),c=r(52643),l=r(35294),o=r(66766),m=r(6874),u=r.n(m),g=r(40563);function h(){let e=(0,i.jE)(),[t,r]=(0,n.useState)(""),[m,h]=(0,n.useState)(!1),{data:p,isLoading:x}=(0,a.I)({queryKey:["trending-products"],queryFn:async()=>{let{data:e,error:t}=await c.N.from("products").select("\n          id,\n          name,\n          price,\n          compare_at_price,\n          stock,\n          status,\n          is_trending,\n          trending_order,\n          images,\n          slug\n        ").eq("is_trending",!0).order("trending_order",{ascending:!0}).order("created_at",{ascending:!1});if(t)throw t;return e}}),{data:b,isLoading:f}=(0,a.I)({queryKey:["products-search",t],queryFn:async()=>{if(!t||t.length<2)return[];let{data:e,error:r}=await c.N.from("products").select("\n          id,\n          name,\n          price,\n          compare_at_price,\n          stock,\n          status,\n          is_trending,\n          images,\n          slug\n        ").ilike("name","%".concat(t,"%")).eq("status","active").limit(10);if(r)throw r;return e},enabled:t.length>=2}),y=(0,d.n)({mutationFn:async e=>{let{id:t,is_trending:r,trending_order:s}=e,{error:n}=await c.N.from("products").update({is_trending:r,trending_order:s}).eq("id",t);if(n)throw n},onSuccess:()=>{e.invalidateQueries({queryKey:["trending-products"]})}}),v=(0,d.n)({mutationFn:async e=>{await Promise.all(e.map(e=>{let{id:t,trending_order:r}=e;return c.N.from("products").update({trending_order:r}).eq("id",t)}))},onSuccess:()=>{e.invalidateQueries({queryKey:["trending-products"]})}}),j=e=>{y.mutate({id:e.id,is_trending:!e.is_trending,trending_order:e.is_trending?null:((null==p?void 0:p.length)||0)+1})},N=e=>e&&0!==e.length?e[0]:null;return(0,s.jsxs)("div",{className:"container py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"\uD83D\uDD25 Trending Products"}),(0,s.jsx)("button",{onClick:()=>h(!m),className:"bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-dark",children:m?"Hide Search":"Add Products"})]}),m&&(0,s.jsxs)("div",{className:"mb-8 p-4 bg-gray-50 rounded-lg",children:[(0,s.jsx)("div",{className:"mb-4",children:(0,s.jsx)("input",{type:"text",placeholder:"Search products...",value:t,onChange:e=>r(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})}),f&&t.length>=2&&(0,s.jsx)("div",{className:"text-center py-4",children:"Searching..."}),b&&b.length>0&&(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:b.map(e=>(0,s.jsxs)("div",{className:"p-3 border rounded-md flex items-center justify-between ".concat(e.is_trending?"bg-green-50 border-green-200":"bg-white"),children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"w-12 h-12 relative bg-gray-100 rounded overflow-hidden",children:(0,s.jsx)(o.default,{src:(0,g.a)(N(e.images)),alt:e.name,fill:!0,sizes:"48px",className:"object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-medium text-sm",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["KSh ",e.price.toLocaleString(),e.compare_at_price&&e.compare_at_price>e.price&&(0,s.jsxs)("span",{className:"ml-2 line-through",children:["KSh ",e.compare_at_price.toLocaleString()]})]})]})]}),(0,s.jsx)("button",{onClick:()=>j(e),className:"px-3 py-1 text-xs rounded-md ".concat(e.is_trending?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:e.is_trending?"Remove":"Add"})]},e.id))}),b&&0===b.length&&t.length>=2&&!f&&(0,s.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No products found"})]}),(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Current Trending Products"}),x&&(0,s.jsx)("div",{className:"text-center py-8",children:"Loading trending products..."}),p&&0===p.length&&(0,s.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No trending products yet. Use the search above to add products."}),p&&p.length>0&&(0,s.jsx)(l.JY,{onDragEnd:e=>{if(!e.destination||!p)return;let t=Array.from(p||[]).filter(Boolean),[r]=t.splice(e.source.index,1);t.splice(e.destination.index,0,r);let s=t.map((e,t)=>({id:e.id,trending_order:t+1}));v.mutate(s)},children:(0,s.jsx)(l.gL,{droppableId:"trending-products",children:e=>(0,s.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"space-y-2",children:[p.map((e,t)=>(0,s.jsx)(l.sx,{draggableId:e.id,index:t,children:r=>(0,s.jsxs)("div",{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,className:"p-3 border border-gray-200 rounded-md bg-white flex items-center justify-between hover:bg-gray-50",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)("div",{className:"text-gray-500 font-semibold w-6 text-center",children:t+1}),(0,s.jsx)("div",{className:"w-12 h-12 relative bg-gray-100 rounded overflow-hidden",children:(0,s.jsx)(o.default,{src:(0,g.a)(N(e.images)),alt:e.name,fill:!0,sizes:"48px",className:"object-cover"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)(u(),{href:"/admin/products/edit/".concat(e.id),className:"font-medium text-sm hover:text-primary",children:e.name}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:["KSh ",e.price.toLocaleString(),e.compare_at_price&&e.compare_at_price>e.price&&(0,s.jsxs)("span",{className:"ml-2 line-through",children:["KSh ",e.compare_at_price.toLocaleString()]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(u(),{href:"/admin/products/edit/".concat(e.id),className:"text-xs px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>j(e),className:"text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Remove"})]})]})},e.id)),e.placeholder]})})})]})]})}},38283:(e,t,r)=>{Promise.resolve().then(r.bind(r,11684))},40563:(e,t,r)=>{"use strict";r.d(t,{a:()=>i});let s="/images/placeholder.png",n="https://tafojbtftmihrheeyoky.supabase.co";function i(e,t){let r;if(!e||("string"==typeof e?r=e:e&&"object"==typeof e&&(r=e.web_image_url||e.web_optimized_image_url||e.feed_image_url||e.url||e.src),!r))return s;if(r.startsWith("http")||r.startsWith("/"))return r;let i=(null==t?void 0:t.bucket)||"product-images";return r.includes("../")||r.includes("..\\")?s:n?"".concat(n,"/storage/v1/object/public/").concat(i,"/").concat(r):"/".concat(i,"/").concat(r)}},52643:(e,t,r)=>{"use strict";r.d(t,{N:()=>i});var s=r(34982);let n=async(e,t)=>{let{timeout:r=3e4}=t||{},s=new AbortController,n=setTimeout(()=>s.abort(),r),i=await fetch(e,{...t,signal:s.signal});return clearTimeout(n),i},i=(0,s.UU)("https://tafojbtftmihrheeyoky.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhZm9qYnRmdG1paHJoZWV5b2t5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ3Mzk3MTYsImV4cCI6MjA2MDMxNTcxNn0.vdL2odCYREv1GykTt8wx76lmhaHmDkBYcC65L4Z_vXo",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{fetch:n}})}},e=>{var t=t=>e(e.s=t);e.O(0,[1309,4982,6874,3063,9373,1202,8441,1684,7358],()=>t(38283)),_N_E=e.O()}]);