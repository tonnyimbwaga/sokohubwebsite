(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7575],{15957:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>N});var s=a(95155),r=a(12115),l=a(73579),i=a(19373),n=a(62177),c=a(52643),d=a(26715),o=a(5041),m=a(35299),u=a(11518),x=a.n(u);let g=e=>{let{initialContent:t="",onChange:a,className:l}=e,i=(0,r.useRef)(null);return(0,r.useEffect)(()=>{i.current&&(i.current.innerHTML=t)},[t]),(0,s.jsxs)("div",{style:{fontFamily:"Karla, sans-serif"},className:"jsx-1c8c36f32d07738f "+"simple-rich-text-editor border rounded p-2 bg-white min-h-[200px] ".concat(null!=l?l:""),children:[(0,s.jsx)("div",{ref:i,contentEditable:!0,suppressContentEditableWarning:!0,onInput:()=>{i.current&&(null==a||a(i.current.innerHTML))},style:{fontFamily:"inherit",padding:8},spellCheck:!0,className:"jsx-1c8c36f32d07738f outline-none min-h-[160px] prose max-w-none"}),(0,s.jsx)(x(),{id:"1c8c36f32d07738f",children:".simple-rich-text-editor.jsx-1c8c36f32d07738f h2.jsx-1c8c36f32d07738f{font-size:1.15rem;font-weight:600;margin:.75rem 0 .4rem}.simple-rich-text-editor.jsx-1c8c36f32d07738f h3.jsx-1c8c36f32d07738f{font-size:1.05rem;font-weight:600;margin:.6rem 0 .3rem}.simple-rich-text-editor.jsx-1c8c36f32d07738f h4.jsx-1c8c36f32d07738f{font-size:.95rem;font-weight:600;margin:.5rem 0 .2rem}.simple-rich-text-editor.jsx-1c8c36f32d07738f ul.jsx-1c8c36f32d07738f{list-style:disc;margin-left:1.5rem}.simple-rich-text-editor.jsx-1c8c36f32d07738f ol.jsx-1c8c36f32d07738f{list-style:decimal;margin-left:1.5rem}.simple-rich-text-editor.jsx-1c8c36f32d07738f b.jsx-1c8c36f32d07738f,.simple-rich-text-editor.jsx-1c8c36f32d07738f strong.jsx-1c8c36f32d07738f{font-weight:bold}.simple-rich-text-editor.jsx-1c8c36f32d07738f p.jsx-1c8c36f32d07738f{margin:.5em 0}"})]})},p={bicycle:[{label:"12 inch",value:'12"'},{label:"14 inch",value:'14"'},{label:"16 inch",value:'16"'},{label:"18 inch",value:'18"'},{label:"20 inch",value:'20"'},{label:"24 inch",value:'24"'},{label:"26 inch",value:'26"'}],skates:[{label:"EU 28–31",value:"28–31"},{label:"EU 32–35",value:"32–35"},{label:"EU 36–39",value:"36–39"},{label:"EU 40–43",value:"40–43"},{label:"EU 43–45",value:"43–45"},{label:"EU 45–48",value:"45–48"}],general:[{label:"XS",value:"XS"},{label:"S",value:"S"},{label:"M",value:"M"},{label:"L",value:"L"},{label:"XL",value:"XL"}]},h=e=>{let{initialSizes:t=[],onChange:a}=e,[l,i]=(0,r.useState)(t),[n,c]=(0,r.useState)("general"),[d,o]=(0,r.useState)(""),[m,u]=(0,r.useState)(0);(0,r.useEffect)(()=>{null==a||a(l)},[l,a]);let x=e=>{let t=l.filter((t,a)=>a!==e);i(t),null==a||a(t)},g=(e,t,s)=>{let r=l.map((a,r)=>r===e?{...a,[t]:s}:a);i(r),null==a||a(r)};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-stretch sm:items-center",children:[(0,s.jsxs)("select",{value:n,onChange:e=>c(e.target.value),className:"rounded-lg border p-3 text-base w-full sm:w-auto",children:[(0,s.jsx)("option",{value:"general",children:"General Sizes"}),(0,s.jsx)("option",{value:"bicycle",children:"Bicycle Sizes"}),(0,s.jsx)("option",{value:"skates",children:"Skates Sizes"})]}),(0,s.jsx)("button",{onClick:()=>{let e=p[n].map(e=>({value:e.value,label:e.label,type:n,price:0,available:!0}));i(e),null==a||a(e)},className:"bg-primary text-white px-6 py-3 rounded-lg font-semibold shadow-sm hover:bg-primary-dark transition whitespace-nowrap w-full sm:w-auto",type:"button",children:"Add Default Sizes"})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-stretch sm:items-center",children:[(0,s.jsx)("input",{type:"text",value:d,onChange:e=>o(e.target.value),placeholder:"Enter size value",className:"rounded-lg border p-3 text-base w-full sm:w-auto"}),(0,s.jsx)("input",{type:"number",value:m,onChange:e=>u(Number(e.target.value)),placeholder:"Price (required)",className:"rounded-lg border p-3 text-base font-mono text-right w-full sm:w-auto",min:0,required:!0,style:{minWidth:"150px",maxWidth:"100%"}}),(0,s.jsx)("button",{onClick:()=>{if(!d.trim()||!m||m<=0)return;let e={value:d,label:d,type:n,price:m,available:!0};i([...l,e]),o(""),u(0),null==a||a([...l,e])},className:"bg-primary text-white px-6 py-3 rounded-lg font-semibold shadow-sm hover:bg-primary-dark transition whitespace-nowrap w-full sm:w-auto",type:"button",children:"Add Size"})]}),(0,s.jsx)("div",{className:"space-y-4",children:l.map((e,t)=>(0,s.jsxs)("div",{className:"rounded-lg border shadow-sm bg-white p-4 flex flex-col gap-3",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Label"}),(0,s.jsx)("input",{type:"text",value:e.label,onChange:e=>g(t,"label",e.target.value),placeholder:"e.g. EU 28–31",className:"rounded border p-2 text-base w-full",required:!0})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Value/Code"}),(0,s.jsx)("input",{type:"text",value:e.value,onChange:e=>g(t,"value",e.target.value),placeholder:"e.g. 28–31",className:"rounded border p-2 text-base w-full",required:!0})]})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 items-end",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"Price (Ksh)"}),(0,s.jsx)("input",{type:"number",value:e.price,onChange:e=>g(t,"price",Number(e.target.value)),placeholder:"Price",className:"rounded border p-2 text-lg font-mono w-full",min:0,required:!0,style:{textAlign:"right"}})]}),(0,s.jsxs)("div",{className:"flex gap-2 items-center pt-5 sm:pt-0",children:[(0,s.jsx)("button",{onClick:()=>g(t,"available",!e.available),className:"px-3 py-2 rounded ".concat(e.available?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),type:"button",title:e.available?"Mark as unavailable":"Mark as available",children:e.available?"Available":"Unavailable"}),(0,s.jsx)("button",{onClick:()=>x(t),className:"text-red-500 hover:text-red-700 p-2 rounded focus:outline-none focus:ring-2 focus:ring-red-400",type:"button","aria-label":"Remove size",title:"Remove size",children:"\xd7"})]})]})]},t))})]})},f=e=>e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").slice(0,50);function b(e){var t,a,l;let{product:u,onClose:x}=e,[p,b]=(0,r.useState)(!1),[y,v]=(0,r.useState)(null),[j,N]=(0,r.useState)((null==u?void 0:u.images)||[]),[w,_]=(0,r.useState)((null==u?void 0:u.sizes)||[]),k=(0,d.jE)(),{data:C,isLoading:S}=(0,i.I)({queryKey:["categories-list"],queryFn:async()=>{let{data:e,error:t}=await c.N.from("categories").select("id, name").eq("is_active",!0);if(t)throw t;return e||[]},staleTime:9e5}),z={...u,images:(null==u?void 0:u.images)||[],status:(null==u?void 0:u.status)||"active",stock:null!=(t=null==u?void 0:u.stock)?t:8,is_featured:(null==u?void 0:u.is_featured)||!1,is_trending:(null==u?void 0:u.is_trending)||!1,is_deal:(null==u?void 0:u.is_deal)||!1,compare_at_price:null!=(a=null==u?void 0:u.compare_at_price)?a:null,sizes:(null==u?void 0:u.sizes)||[],price:null!=(l=null==u?void 0:u.price)?l:null,tags:(null==u?void 0:u.tags)||[],category_ids:(null==u?void 0:u.category_ids)||((null==u?void 0:u.category_id)?[u.category_id]:[])},{register:A,handleSubmit:E,formState:{errors:I},control:q,watch:P,setValue:M}=(0,n.mN)({defaultValues:z,mode:"onTouched",reValidateMode:"onChange"}),F="product-images",L=P("name");(0,r.useEffect)(()=>{!L||(null==u?void 0:u.slug)||M("slug",f(L))},[L,M,null==u?void 0:u.slug]);let T=e=>{let t=j.filter((t,a)=>a!==e);N(t),M("images",t)},U=(e,t)=>{let a=j.map((a,s)=>s===e?{...a,alt:t}:a);N(a),M("images",a)},R=(0,o.n)({mutationFn:async e=>{let t,a={name:e.name,slug:e.slug,description:e.description,price:e.price,compare_at_price:e.compare_at_price,stock:e.stock,category_id:e.category_ids[0]||null,status:e.status,is_featured:e.is_featured,is_trending:e.is_trending,is_deal:e.is_deal,images:e.images,sizes:e.sizes,tags:e.tags};if(null==u?void 0:u.id){let{error:e}=await c.N.from("products").update(a).eq("id",u.id);if(e)throw e;t=u.id}else{let{data:e,error:s}=await c.N.from("products").insert(a).select().single();if(s)throw s;t=e.id}if(e.category_ids&&e.category_ids.length>0){let{error:a}=await c.N.rpc("update_product_categories",{p_product_id:t,p_category_ids:e.category_ids})}return{id:t,...a}},onSuccess:()=>{k.invalidateQueries({queryKey:["products"]}),x()},onError:e=>{v(e.message)}}),V=async e=>{b(!0),v(null),R.mutate({...e,sizes:w},{onSettled:()=>{b(!1)}})};return(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30 overflow-y-auto",children:(0,s.jsxs)("div",{className:"relative w-full max-w-2xl mx-auto my-8 bg-white rounded-2xl shadow-2xl flex flex-col max-h-[90vh]",children:[(0,s.jsx)("header",{className:"sticky top-0 z-20 bg-white px-8 pt-8 pb-4 border-b",children:(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:u?"Edit Product":"Create New Product"})}),(0,s.jsxs)("form",{id:"product-form",onSubmit:E(V),className:"flex-1 overflow-y-auto px-8 py-6 space-y-10",children:[(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Product Details"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Name"}),(0,s.jsx)("input",{type:"text",id:"name",...A("name",{required:"Product name is required"}),className:"block w-full border border-gray-300 rounded-lg px-4 py-3 focus:ring-primary focus:border-primary text-base"}),I.name&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:I.name.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-1",children:"Slug"}),(0,s.jsx)("input",{type:"text",id:"slug",...A("slug",{required:"Slug is required"}),className:"block w-full border border-gray-300 rounded-lg px-4 py-3 bg-gray-100 text-base",readOnly:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,s.jsx)(n.xI,{name:"description",control:q,render:e=>{let{field:t}=e;return(0,s.jsx)(g,{initialContent:t.value,onChange:t.onChange})}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags (comma-separated)"}),(0,s.jsx)(n.xI,{name:"tags",control:q,defaultValue:[],render:e=>{let{field:t}=e;return(0,s.jsx)("input",{type:"text",id:"tags",className:"block w-full border border-gray-300 rounded-lg px-4 py-3 text-base",defaultValue:Array.isArray(t.value)?t.value.join(", "):"",onChange:e=>{let a=e.target.value.split(",").map(e=>e.trim()).filter(Boolean);t.onChange(a)}})}})]})]})]}),(0,s.jsx)("hr",{className:"my-6 border-gray-200"}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Pricing & Stock"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Price"}),(0,s.jsx)("input",{type:"number",id:"price",...A("price",{valueAsNumber:!0,validate:e=>w&&w.length>0||null!==e&&e>0||"Price is required if there are no sizes."}),className:"block w-full border border-gray-300 rounded-lg px-4 py-3 text-base",step:"0.01",disabled:w&&w.length>0}),I.price&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:I.price.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"compare_at_price",className:"block text-sm font-medium text-gray-700 mb-1",children:"Compare at Price"}),(0,s.jsx)("input",{type:"number",id:"compare_at_price",...A("compare_at_price",{valueAsNumber:!0}),className:"block w-full border border-gray-300 rounded-lg px-4 py-3 text-base",step:"0.01"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"stock",className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock"}),(0,s.jsx)("input",{type:"number",id:"stock",...A("stock",{required:"Stock is required",valueAsNumber:!0,min:0}),className:"block w-full border border-gray-300 rounded-lg px-4 py-3 text-base"}),I.stock&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:I.stock.message})]})]})]}),(0,s.jsx)("hr",{className:"my-6 border-gray-200"}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Sizes"}),(0,s.jsx)(h,{initialSizes:w,onChange:_})]}),(0,s.jsx)("hr",{className:"my-6 border-gray-200"}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Organization"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"category_ids",className:"block text-sm font-medium text-gray-700 mb-1",children:"Categories"}),S?(0,s.jsx)("p",{children:"Loading categories..."}):(0,s.jsx)(n.xI,{name:"category_ids",control:q,rules:{required:"At least one category is required"},render:e=>{let{field:t}=e;return(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:null==C?void 0:C.map(e=>{var a;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{id:"category-".concat(e.id),type:"checkbox",className:"h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded",checked:null==(a=t.value)?void 0:a.includes(e.id),onChange:a=>{let s=a.target.checked?[...t.value||[],e.id]:(t.value||[]).filter(t=>t!==e.id);t.onChange(s)}}),(0,s.jsx)("label",{htmlFor:"category-".concat(e.id),className:"block text-sm text-gray-900",children:e.name})]},e.id)})})}}),I.category_ids&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:I.category_ids.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,s.jsxs)("select",{id:"status",...A("status",{required:"Status is required"}),className:"block w-full border border-gray-300 rounded-lg px-4 py-3 text-base",children:[(0,s.jsx)("option",{value:"active",children:"Active"}),(0,s.jsx)("option",{value:"draft",children:"Draft"}),(0,s.jsx)("option",{value:"archived",children:"Archived"})]}),I.status&&(0,s.jsx)("p",{className:"text-red-500 text-xs mt-1",children:I.status.message})]}),(0,s.jsxs)("div",{className:"space-y-2 pt-2",children:[(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex items-center h-5",children:(0,s.jsx)("input",{id:"is_featured",...A("is_featured"),type:"checkbox",className:"focus:ring-primary h-4 w-4 text-primary border-gray-300 rounded"})}),(0,s.jsxs)("div",{className:"ml-3 text-sm",children:[(0,s.jsx)("label",{htmlFor:"is_featured",className:"font-medium text-gray-700",children:"Featured"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Display on main featured sections."})]})]}),(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex items-center h-5",children:(0,s.jsx)("input",{id:"is_trending",...A("is_trending"),type:"checkbox",className:"focus:ring-primary h-4 w-4 text-primary border-gray-300 rounded"})}),(0,s.jsxs)("div",{className:"ml-3 text-sm",children:[(0,s.jsx)("label",{htmlFor:"is_trending",className:"font-medium text-gray-700",children:"Trending"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Mark as a trending product."})]})]}),(0,s.jsxs)("div",{className:"flex items-start",children:[(0,s.jsx)("div",{className:"flex items-center h-5",children:(0,s.jsx)("input",{id:"is_deal",...A("is_deal"),type:"checkbox",className:"focus:ring-primary h-4 w-4 text-primary border-gray-300 rounded"})}),(0,s.jsxs)("div",{className:"ml-3 text-sm",children:[(0,s.jsx)("label",{htmlFor:"is_deal",className:"font-medium text-gray-700",children:"Deal"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Mark as a special deal."})]})]})]})]})]}),(0,s.jsx)("hr",{className:"my-6 border-gray-200"}),(0,s.jsxs)("section",{children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Product Images"}),(0,s.jsx)(m.V,{bucket:F,onComplete:e=>{let t=[...j,{web_image_url:e.webp,feed_image_url:e.original,alt:""}];N(t),M("images",t)},maxFiles:5}),(0,s.jsx)("div",{className:"mt-6 grid grid-cols-1 sm:grid-cols-2 gap-6",children:j.map((e,t)=>(0,s.jsxs)("div",{className:"relative flex flex-col items-center bg-white border rounded-lg p-4 shadow-sm",children:[(0,s.jsx)("img",{src:"".concat(c.N.storage.from(F).getPublicUrl(e.web_image_url).data.publicUrl),alt:e.alt||"Product image ".concat(t+1),className:"h-32 w-full object-cover rounded-md mb-2"}),(0,s.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Alt text"}),(0,s.jsx)("input",{type:"text",placeholder:"Alt text",value:e.alt,onChange:e=>U(t,e.target.value),className:"block w-full text-xs border-gray-300 rounded-md shadow-sm focus:ring-primary focus:border-primary px-2 py-1 mb-2"}),(0,s.jsx)("button",{type:"button",onClick:()=>T(t),className:"absolute top-2 right-2 text-white bg-red-600 hover:bg-red-700 rounded-full p-1 shadow",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z",clipRule:"evenodd"})})})]},t))})]}),y&&(0,s.jsxs)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mt-6",role:"alert",children:[(0,s.jsx)("strong",{className:"font-bold",children:"Error:"}),(0,s.jsxs)("span",{className:"block sm:inline",children:[" ",y]})]})]}),(0,s.jsxs)("footer",{className:"sticky bottom-0 z-30 bg-white px-8 py-4 border-t flex justify-end gap-4 rounded-b-2xl",children:[(0,s.jsx)("button",{type:"button",onClick:x,className:"bg-white py-2 px-6 border border-gray-300 rounded-lg shadow-sm text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",form:"product-form",disabled:p,className:"inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-base font-medium rounded-lg text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary disabled:opacity-50",children:p?"Saving...":u?"Save Changes":"Create Product"})]})]})})}var y=a(78260),v=a(40563);let j=e=>e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").slice(0,50);function N(){let[e,t]=(0,r.useState)(1),[a,n]=(0,r.useState)(""),[c,d]=(0,r.useState)(!1),[o,m]=(0,r.useState)(null),u=(0,l.createClientComponentClient)(),{data:x}=(0,i.I)({queryKey:["categories-list"],queryFn:async()=>{let{data:e,error:t}=await u.from("categories").select("id, name");if(t)throw t;return e||[]},staleTime:6e5}),g={};null==x||x.forEach(e=>{g[e.id]=e.name});let{data:p,isLoading:h}=(0,i.I)({queryKey:["products",e,a],queryFn:async()=>{let t=u.from("products").select("\n          id,\n          name,\n          description,\n          price,\n          compare_at_price,\n          stock,\n          status,\n          category_id,\n          is_featured,\n          is_trending,\n          is_deal,\n          created_at,\n          slug,\n          images,\n          sizes,\n          tags,\n          category:categories(id, name)\n        ").range((e-1)*10,10*e-1).order("created_at",{ascending:!1});a&&(t=t.filter("name","ilike","%".concat(a,"%")));let{data:s,error:r}=await t;if(r)throw r;return s.map(e=>({...e,category:Array.isArray(e.category)?e.category[0]:null}))},staleTime:3e5}),{data:f}=(0,i.I)({queryKey:["products-count",a],queryFn:async()=>{let e=u.from("products").select("*",{count:"exact",head:!0});a&&(e=e.filter("name","ilike","%".concat(a,"%")));let{count:t,error:s}=await e;if(s)throw s;return t||0},staleTime:3e5}),N=Math.ceil((f||0)/10),w=async e=>{if(!window.confirm("Are you sure you want to delete this product? This action cannot be undone."))return;let{error:t}=await u.from("products").delete().eq("id",e);t?y.oR.error("Failed to delete product: "+t.message):(y.oR.success("Product deleted successfully"),window.location.reload())};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900",children:"Products"}),(0,s.jsx)("button",{onClick:()=>{m(null),d(!0)},className:"rounded-md bg-primary px-4 py-2 text-white hover:bg-primary-dark",children:"Add Product"})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsx)("input",{type:"text",placeholder:"Search products...",value:a,onChange:e=>n(e.target.value),className:"w-full rounded-md border border-gray-300 px-4 py-2 focus:border-primary focus:outline-none"})}),c&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-center overflow-y-auto bg-black bg-opacity-50 p-4",children:(0,s.jsxs)("div",{className:"relative w-full max-w-2xl rounded-lg bg-white shadow-xl my-8",children:[(0,s.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:o?"Edit Product":"Add New Product"})}),(0,s.jsx)("div",{className:"max-h-[calc(100vh-200px)] overflow-y-auto p-6",children:(0,s.jsx)(b,{product:o?{...o,slug:o.slug||j(o.name),category_ids:o.category_id?[o.category_id]:[],compare_at_price:o.compare_at_price||null,images:Array.isArray(o.images)?o.images.map(e=>({web_image_url:e.web_image_url||e.webp_url||"",feed_image_url:e.feed_image_url||e.feed_url||"",alt:e.alt||""})):[],sizes:o.sizes||[],tags:o.tags||[]}:void 0,onClose:()=>{d(!1),m(null)}})})]})}),(0,s.jsx)("div",{className:"overflow-x-auto rounded-lg border border-gray-200",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Product"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Category"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Price"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Stock"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 bg-white",children:h?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center",children:"Loading..."})}):(null==p?void 0:p.length)===0?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center",children:"No products found"})}):null==p?void 0:p.map(e=>{var t;return(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"whitespace-nowrap px-6 py-4",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"h-10 w-10 flex-shrink-0",children:(0,s.jsx)("img",{className:"h-10 w-10 rounded-full object-cover",src:(0,v.a)(null==(t=e.images)?void 0:t[0]),alt:e.name})}),(0,s.jsx)("div",{className:"ml-4",children:(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name})})]})}),(0,s.jsx)("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:e.category&&e.category.name?e.category.name:e.category_id&&g[e.category_id]?g[e.category_id]:"Uncategorized"}),(0,s.jsxs)("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:["Ksh ",e.price.toLocaleString("en-KE")]}),(0,s.jsx)("td",{className:"whitespace-nowrap px-6 py-4 text-sm text-gray-500",children:e.stock}),(0,s.jsx)("td",{className:"whitespace-nowrap px-6 py-4",children:(0,s.jsx)("span",{className:"inline-flex rounded-full px-2 text-xs font-semibold ".concat("active"===e.status?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.status})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>{m(e),d(!0)},className:"text-primary hover:underline mr-4",children:"Edit"}),(0,s.jsx)("button",{onClick:()=>w(e.id),className:"text-red-600 hover:underline",children:"Delete"})]})]},e.id)})})]})}),N>1&&(0,s.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6",children:[(0,s.jsxs)("div",{className:"flex flex-1 justify-between sm:hidden",children:[(0,s.jsx)("button",{onClick:()=>t(e=>Math.max(1,e-1)),disabled:1===e,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Previous"}),(0,s.jsx)("button",{onClick:()=>t(e=>Math.min(N,e+1)),disabled:e===N,className:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",children:"Next"})]}),(0,s.jsxs)("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Showing ",(0,s.jsx)("span",{className:"font-medium",children:(e-1)*10+1})," to"," ",(0,s.jsx)("span",{className:"font-medium",children:Math.min(10*e,f||0)})," ","of ",(0,s.jsx)("span",{className:"font-medium",children:f})," results"]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[(0,s.jsx)("button",{onClick:()=>t(e=>Math.max(1,e-1)),disabled:1===e,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",children:"Previous"}),Array.from({length:N},(e,t)=>t+1).map(a=>(0,s.jsx)("button",{onClick:()=>t(a),className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold ".concat(a===e?"z-10 bg-primary text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"),children:a},a)),(0,s.jsx)("button",{onClick:()=>t(e=>Math.min(N,e+1)),disabled:e===N,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",children:"Next"})]})})]})]})]})}},19850:(e,t,a)=>{Promise.resolve().then(a.bind(a,15957))},35299:(e,t,a)=>{"use strict";a.d(t,{V:()=>c});var s=a(95155),r=a(12115),l=a(73579),i=a(51368),n=a(31802);let c=e=>{let{bucket:t,onComplete:a,maxFiles:c=1,acceptedFileTypes:d=["image/jpeg","image/png","image/webp"]}=e,[o,m]=(0,r.useState)(!1),[u,x]=(0,r.useState)(0),g=(0,l.createClientComponentClient)(),p=(0,r.useCallback)(async e=>{try{if(!e.target.files||0===e.target.files.length)return;m(!0),x(0);let r=Array.from(e.target.files).slice(0,c);for(let[e,l]of r.entries()){var s;if(!d.includes(l.type)){alert("Skipping file ".concat(l.name,": Invalid file type ").concat(l.type));continue}let c=(null==(s=l.name.split(".").pop())?void 0:s.toLowerCase())||"";if(!["jpg","jpeg","png","webp"].includes(c)){alert("Skipping file ".concat(l.name,": Invalid extension ").concat(c));continue}let o=l,m=l,u="",p="";try{o=await (0,n.A)(l,{maxSizeMB:1,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/webp",initialQuality:.85}),u="".concat((0,i.A)(),".webp"),m=await (0,n.A)(l,{maxSizeMB:1,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/jpeg",initialQuality:.85}),p="".concat((0,i.A)(),".jpg")}catch(e){alert("Image optimization failed. Uploading original file."),u="".concat((0,i.A)(),".webp"),p="".concat((0,i.A)(),".jpg")}let h=setInterval(()=>{x(e=>Math.min(e+10,90))},100);try{let{error:s}=await g.storage.from(t).upload(u,o,{cacheControl:"3600",upsert:!0});if(s)throw s;let{error:l}=await g.storage.from(t).upload(p,m,{cacheControl:"3600",upsert:!0});if(l)throw l;x(100),a({webp:u,original:p}),e<r.length-1&&x(0)}catch(e){alert("Error uploading file: "+(e instanceof Error?e.message:JSON.stringify(e,null,2)))}finally{clearInterval(h)}}}catch(e){alert("Error in handleUpload: "+(e instanceof Error?e.message:JSON.stringify(e,null,2)))}finally{m(!1),x(0)}},[t,c,d,a,g]);return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"file",onChange:p,accept:d.join(","),multiple:c>1,disabled:o,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary-light file:text-primary hover:file:bg-primary hover:file:text-white"}),o&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"h-2 bg-gray-200 rounded",children:(0,s.jsx)("div",{className:"h-2 bg-primary rounded transition-all duration-300",style:{width:"".concat(u,"%")}})}),(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Uploading... ",u,"%"]})]})]})}},40563:(e,t,a)=>{"use strict";a.d(t,{a:()=>l});let s="/images/placeholder.png",r="https://tafojbtftmihrheeyoky.supabase.co";function l(e,t){let a;if(!e||("string"==typeof e?a=e:e&&"object"==typeof e&&(a=e.web_image_url||e.web_optimized_image_url||e.feed_image_url||e.url||e.src),!a))return s;if(a.startsWith("http")||a.startsWith("/"))return a;let l=(null==t?void 0:t.bucket)||"product-images";return a.includes("../")||a.includes("..\\")?s:r?"".concat(r,"/storage/v1/object/public/").concat(l,"/").concat(a):"/".concat(l,"/").concat(a)}},52643:(e,t,a)=>{"use strict";a.d(t,{N:()=>l});var s=a(34982);let r=async(e,t)=>{let{timeout:a=3e4}=t||{},s=new AbortController,r=setTimeout(()=>s.abort(),a),l=await fetch(e,{...t,signal:s.signal});return clearTimeout(r),l},l=(0,s.UU)("https://tafojbtftmihrheeyoky.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhZm9qYnRmdG1paHJoZWV5b2t5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ3Mzk3MTYsImV4cCI6MjA2MDMxNTcxNn0.vdL2odCYREv1GykTt8wx76lmhaHmDkBYcC65L4Z_vXo",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{fetch:r}})}},e=>{var t=t=>e(e.s=t);e.O(0,[4982,9373,3579,8260,7375,2177,2466,8441,1684,7358],()=>t(19850)),_N_E=e.O()}]);