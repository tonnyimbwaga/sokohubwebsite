(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3062],{40563:(e,t,r)=>{"use strict";r.d(t,{a:()=>c});let a="/images/placeholder.png",s="https://tafojbtftmihrheeyoky.supabase.co";function c(e,t){let r;if(!e||("string"==typeof e?r=e:e&&"object"==typeof e&&(r=e.web_image_url||e.web_optimized_image_url||e.feed_image_url||e.url||e.src),!r))return a;if(r.startsWith("http")||r.startsWith("/"))return r;let c=(null==t?void 0:t.bucket)||"product-images";return r.includes("../")||r.includes("..\\")?a:s?"".concat(s,"/storage/v1/object/public/").concat(c,"/").concat(r):"/".concat(c,"/").concat(r)}},51263:(e,t,r)=>{Promise.resolve().then(r.bind(r,68280))},52643:(e,t,r)=>{"use strict";r.d(t,{N:()=>c});var a=r(34982);let s=async(e,t)=>{let{timeout:r=3e4}=t||{},a=new AbortController,s=setTimeout(()=>a.abort(),r),c=await fetch(e,{...t,signal:a.signal});return clearTimeout(s),c},c=(0,a.UU)("https://tafojbtftmihrheeyoky.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRhZm9qYnRmdG1paHJoZWV5b2t5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQ3Mzk3MTYsImV4cCI6MjA2MDMxNTcxNn0.vdL2odCYREv1GykTt8wx76lmhaHmDkBYcC65L4Z_vXo",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},global:{fetch:s}})},68280:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var a=r(95155),s=r(12115),c=r(26715),i=r(19373),n=r(5041),d=r(52643),l=r(35294),o=r(66766),p=r(6874),m=r.n(p),u=r(40563);function h(){let e=(0,c.jE)(),[t,r]=(0,s.useState)(""),[p,h]=(0,s.useState)(!1),{data:x,isLoading:g}=(0,i.I)({queryKey:["deals-products"],queryFn:async()=>{let{data:e,error:t}=await d.N.from("products").select("\n          id,\n          name,\n          price,\n          compare_at_price,\n          stock,\n          status,\n          is_deal,\n          deal_order,\n          images,\n          slug\n        ").eq("is_deal",!0).eq("status","active").not("compare_at_price","is",null).order("deal_order",{ascending:!0}).order("created_at",{ascending:!1});if(t)throw t;return(e||[]).map(e=>{let t=e.compare_at_price&&e.price?(e.compare_at_price-e.price)/e.compare_at_price*100:0;return{...e,discount_percentage:t}}).sort((e,t)=>t.discount_percentage-e.discount_percentage)}}),{data:_,isLoading:b}=(0,i.I)({queryKey:["products-search",t],queryFn:async()=>{if(!t||t.length<2)return[];let{data:e,error:r}=await d.N.from("products").select("\n          id,\n          name,\n          price,\n          compare_at_price,\n          stock,\n          status,\n          is_deal,\n          images,\n          slug\n        ").ilike("name","%".concat(t,"%")).eq("status","active").limit(10);if(r)throw r;return(e||[]).map(e=>{let t=e.compare_at_price&&e.price?(e.compare_at_price-e.price)/e.compare_at_price*100:0;return{...e,discount_percentage:t}})},enabled:t.length>=2}),v=(0,n.n)({mutationFn:async e=>{let{id:t,is_deal:r,deal_order:a}=e,{error:s}=await d.N.from("products").update({is_deal:r,deal_order:a}).eq("id",t);if(s)throw s},onSuccess:()=>{e.invalidateQueries({queryKey:["deals-products"]})}}),y=(0,n.n)({mutationFn:async e=>{await Promise.all(e.map(e=>{let{id:t,deal_order:r}=e;return d.N.from("products").update({deal_order:r}).eq("id",t)}))},onSuccess:()=>{e.invalidateQueries({queryKey:["deals-products"]})}}),f=e=>{v.mutate({id:e.id,is_deal:!e.is_deal,deal_order:e.is_deal?null:((null==x?void 0:x.length)||0)+1})},j=e=>e&&0!==e.length?e[0]:null,N=e=>void 0===e||isNaN(e)?"":"".concat(Math.round(e),"% OFF");return(0,a.jsxs)("div",{className:"container py-8",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Best Deals"}),(0,a.jsx)("button",{onClick:()=>h(!p),className:"bg-primary text-white px-4 py-2 rounded-md hover:bg-primary-dark",children:p?"Hide Search":"Add Products"})]}),p&&(0,a.jsxs)("div",{className:"mb-8 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"text",placeholder:"Search products...",value:t,onChange:e=>r(e.target.value),className:"w-full p-2 border border-gray-300 rounded-md"})}),b&&t.length>=2&&(0,a.jsx)("div",{className:"text-center py-4",children:"Searching..."}),_&&_.length>0&&(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4",children:_.map(e=>{var t;return(0,a.jsxs)("div",{className:"p-3 border rounded-md flex items-center justify-between ".concat(e.is_deal?"bg-green-50 border-green-200":"bg-white"),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:"w-12 h-12 relative bg-gray-100 rounded overflow-hidden",children:[(0,a.jsx)(o.default,{src:(0,u.a)(j(e.images)),alt:e.name,fill:!0,sizes:"48px",className:"object-cover"}),e.compare_at_price&&e.price&&e.compare_at_price>e.price&&(0,a.jsx)("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-[8px] px-1 py-0.5",children:N(e.discount_percentage)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-sm",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["KSh ",null==(t=e.price)?void 0:t.toLocaleString(),e.compare_at_price&&e.compare_at_price>e.price&&(0,a.jsxs)("span",{className:"ml-2 line-through",children:["KSh ",e.compare_at_price.toLocaleString()]})]})]})]}),(0,a.jsx)("button",{onClick:()=>f(e),className:"px-3 py-1 text-xs rounded-md ".concat(e.is_deal?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"),children:e.is_deal?"Remove":"Add"})]},e.id)})}),_&&0===_.length&&t.length>=2&&!b&&(0,a.jsx)("div",{className:"text-center py-4 text-gray-500",children:"No products found"})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Current Deal Products"}),g&&(0,a.jsx)("div",{className:"text-center py-8",children:"Loading deal products..."}),x&&0===x.length&&(0,a.jsx)("div",{className:"text-center py-8 text-gray-500",children:"No deal products yet. Use the search above to add products."}),x&&x.length>0&&(0,a.jsx)(l.JY,{onDragEnd:e=>{if(!e.destination||!x)return;let t=Array.from(x||[]),[r]=t.splice(e.source.index,1);t.splice(e.destination.index,0,r);let a=t.map((e,t)=>({id:e.id,deal_order:t+1}));y.mutate(a)},children:(0,a.jsx)(l.gL,{droppableId:"deals-products",children:e=>(0,a.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"space-y-2",children:[x.map((e,t)=>(0,a.jsx)(l.sx,{draggableId:e.id,index:t,children:r=>{var s;return(0,a.jsxs)("div",{ref:r.innerRef,...r.draggableProps,...r.dragHandleProps,className:"p-3 border border-gray-200 rounded-md bg-white flex items-center justify-between hover:bg-gray-50",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"text-gray-500 font-semibold w-6 text-center",children:t+1}),(0,a.jsxs)("div",{className:"w-12 h-12 relative bg-gray-100 rounded overflow-hidden",children:[(0,a.jsx)(o.default,{src:(0,u.a)(j(e.images)),alt:e.name,fill:!0,sizes:"48px",className:"object-cover"}),e.compare_at_price&&e.price&&e.compare_at_price>e.price&&(0,a.jsx)("div",{className:"absolute top-0 right-0 bg-red-500 text-white text-[8px] px-1 py-0.5",children:N(e.discount_percentage)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(m(),{href:"/admin/products/edit/".concat(e.id),className:"font-medium text-sm hover:text-primary",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:["KSh ",null==(s=e.price)?void 0:s.toLocaleString(),e.compare_at_price&&e.compare_at_price>e.price&&(0,a.jsxs)("span",{className:"ml-2 line-through",children:["KSh ",e.compare_at_price.toLocaleString()]})]}),e.discount_percentage&&e.discount_percentage>0&&(0,a.jsx)("span",{className:"ml-2 text-xs bg-red-100 text-red-700 px-1.5 py-0.5 rounded",children:N(e.discount_percentage)})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(m(),{href:"/admin/products/edit/".concat(e.id),className:"text-xs px-2 py-1 bg-gray-100 rounded hover:bg-gray-200",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>f(e),className:"text-xs px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200",children:"Remove"})]})]})}},e.id)),e.placeholder]})})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1309,4982,6874,3063,9373,1202,8441,1684,7358],()=>t(51263)),_N_E=e.O()}]);