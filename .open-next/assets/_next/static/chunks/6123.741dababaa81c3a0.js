"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6123],{35299:(e,t,r)=>{r.d(t,{V:()=>n});var s=r(95155),a=r(12115),l=r(73579),i=r(51368),o=r(31802);let n=e=>{let{bucket:t,onComplete:r,maxFiles:n=1,acceptedFileTypes:c=["image/jpeg","image/png","image/webp"]}=e,[d,m]=(0,a.useState)(!1),[h,g]=(0,a.useState)(0),u=(0,l.createClientComponentClient)(),f=(0,a.useCallback)(async e=>{try{if(!e.target.files||0===e.target.files.length)return;m(!0),g(0);let a=Array.from(e.target.files).slice(0,n);for(let[e,l]of a.entries()){var s;if(!c.includes(l.type)){alert("Skipping file ".concat(l.name,": Invalid file type ").concat(l.type));continue}let n=(null==(s=l.name.split(".").pop())?void 0:s.toLowerCase())||"";if(!["jpg","jpeg","png","webp"].includes(n)){alert("Skipping file ".concat(l.name,": Invalid extension ").concat(n));continue}let d=l,m=l,h="",f="";try{d=await (0,o.A)(l,{maxSizeMB:1,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/webp",initialQuality:.85}),h="".concat((0,i.A)(),".webp"),m=await (0,o.A)(l,{maxSizeMB:1,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/jpeg",initialQuality:.85}),f="".concat((0,i.A)(),".jpg")}catch(e){alert("Image optimization failed. Uploading original file."),h="".concat((0,i.A)(),".webp"),f="".concat((0,i.A)(),".jpg")}let b=setInterval(()=>{g(e=>Math.min(e+10,90))},100);try{let{error:s}=await u.storage.from(t).upload(h,d,{cacheControl:"3600",upsert:!0});if(s)throw s;let{error:l}=await u.storage.from(t).upload(f,m,{cacheControl:"3600",upsert:!0});if(l)throw l;g(100),r({webp:h,original:f}),e<a.length-1&&g(0)}catch(e){alert("Error uploading file: "+(e instanceof Error?e.message:JSON.stringify(e,null,2)))}finally{clearInterval(b)}}}catch(e){alert("Error in handleUpload: "+(e instanceof Error?e.message:JSON.stringify(e,null,2)))}finally{m(!1),g(0)}},[t,n,c,r,u]);return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"file",onChange:f,accept:c.join(","),multiple:n>1,disabled:d,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-primary-light file:text-primary hover:file:bg-primary hover:file:text-white"}),d&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"h-2 bg-gray-200 rounded",children:(0,s.jsx)("div",{className:"h-2 bg-primary rounded transition-all duration-300",style:{width:"".concat(h,"%")}})}),(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-500",children:["Uploading... ",h,"%"]})]})]})}},46123:(e,t,r)=>{r.r(t),r.d(t,{default:()=>S});var s=r(95155),a=r(12115),l=r(62177),i=r(73579),o=r(26715),n=r(19373),c=r(5041),d=r(51368),m=r(11518),h=r.n(m),g=r(75109),u=r(87274),f=r(74979),b=r(84109),x=r(50099),p=r(11585),v=r(96919),j=r(33326),y=r(95523),w=r(35383),N=r(48873),k=r(53872),C=r(40951),z=r(81891);let H=e=>{let{initialContent:t="",onChange:r,className:l}=e,o=(0,g.hG)({extensions:[u.A.configure({heading:{levels:[2,3,4]},bulletList:{keepMarks:!0,keepAttributes:!0},history:!1}),x.Ay,b.A.configure({types:["heading","paragraph"]}),p.A.configure({depth:100,newGroupDelay:500}),f.A.configure({placeholder:"Start writing your blog post..."}),v.Ay.configure({openOnClick:!1,autolink:!0,linkOnPaste:!0}),j.Ay,y.Ay,w.Ay,N.Ay,k.Ay,C.A,z.Ay.configure({HTMLAttributes:{class:"max-w-full h-auto rounded-lg"}})],content:t,editorProps:{attributes:{class:"prose prose-sm sm:prose lg:prose-lg xl:prose-xl focus:outline-none max-w-none min-h-[200px] p-4 border rounded-lg"},handleDOMEvents:{keydown:(e,t)=>{if("Enter"===t.key){let{state:t}=e,{selection:r}=t,{$from:s}=r;if(s.pos===s.end())return t.schema.nodes.paragraph&&e.dispatch(t.tr.insert(s.pos,t.schema.nodes.paragraph.create())),!0}return!1}}},onUpdate:e=>{let{editor:t}=e;null==r||r(t.getHTML())}});(0,a.useEffect)(()=>{o&&t!==o.getHTML()&&o.commands.setContent(t)},[o,t]);let n=e=>{null==o||o.chain().focus().toggleHeading({level:e}).run()};(0,a.useCallback)(async e=>{var t;let r=(0,i.createClientComponentClient)(),s=(null==(t=e.name.split(".").pop())?void 0:t.toLowerCase())||"",a="".concat(Date.now(),"-").concat(Math.random().toString(36).substring(2),".").concat(s);try{let{error:t}=await r.storage.from("blog").upload("content/".concat(a),e);if(t)throw t;let{data:{publicUrl:s}}=r.storage.from("blog").getPublicUrl("content/".concat(a));null==o||o.chain().focus().setImage({src:s}).run()}catch(e){}},[o]);let c=(0,a.useCallback)(()=>{if(!o)return;let e=o.getAttributes("link").href,t=window.prompt("URL",e);if(null!==t){if(""===t)return void o.chain().focus().extendMarkRange("link").unsetLink().run();o.chain().focus().extendMarkRange("link").setLink({href:t}).run()}},[o]);return o?(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb rich-text-editor border border-gray-300 rounded-lg",children:[(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb toolbar border-b p-2 mb-0 bg-gray-50 rounded-t-lg flex flex-wrap items-center gap-x-2 gap-y-1",children:[(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb flex gap-1 items-center border-r border-gray-300 pr-2",children:[(0,s.jsx)("button",{onClick:()=>n(2),type:"button",title:"Heading 2",className:"jsx-6f1f93e81f1735bb "+"px-2 py-1 rounded hover:bg-gray-200 font-semibold ".concat(o.isActive("heading",{level:2})?"bg-gray-200":""),children:"H2"}),(0,s.jsx)("button",{onClick:()=>n(3),type:"button",title:"Heading 3",className:"jsx-6f1f93e81f1735bb "+"px-2 py-1 rounded hover:bg-gray-200 font-semibold ".concat(o.isActive("heading",{level:3})?"bg-gray-200":""),children:"H3"}),(0,s.jsx)("button",{onClick:()=>n(4),type:"button",title:"Heading 4",className:"jsx-6f1f93e81f1735bb "+"px-2 py-1 rounded hover:bg-gray-200 font-semibold ".concat(o.isActive("heading",{level:4})?"bg-gray-200":""),children:"H4"})]}),(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb flex gap-1 items-center border-r border-gray-300 pr-2",children:[(0,s.jsx)("button",{onClick:()=>o.chain().focus().setTextAlign("left").run(),type:"button",title:"Align Left",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive({textAlign:"left"})?"bg-gray-200":""),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M3 5h18v2H3V5zm0 4h12v2H3V9zm0 4h18v2H3v-2zm0 4h12v2H3v-2z",className:"jsx-6f1f93e81f1735bb"})})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().setTextAlign("center").run(),type:"button",title:"Align Center",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive({textAlign:"center"})?"bg-gray-200":""),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M3 5h18v2H3V5zm3 4h12v2H6V9zm-3 4h18v2H3v-2zm3 4h12v2H6v-2z",className:"jsx-6f1f93e81f1735bb"})})})]}),(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb flex gap-1 items-center border-r border-gray-300 pr-2",children:[(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleBold().run(),type:"button",title:"Bold",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("bold")?"bg-gray-200":""),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M8 11h4.5a2.5 2.5 0 1 0 0-5H8v5zm10 4.5a4.5 4.5 0 0 1-4.5 4.5H6V4h6.5a4.5 4.5 0 0 1 3.256 7.606A4.498 4.498 0 0 1 18 15.5zM8 13v5h5.5a2.5 2.5 0 1 0 0-5H8z",className:"jsx-6f1f93e81f1735bb"})})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleItalic().run(),type:"button",title:"Italic",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("italic")?"bg-gray-200":""),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M15 20H7v-2h2.927l2.116-12H9V4h8v2h-2.927l-2.116 12H15z",className:"jsx-6f1f93e81f1735bb"})})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleStrike().run(),type:"button",title:"Strikethrough",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("strike")?"bg-gray-200":""),children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:[(0,s.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM9 12.5h6V14H9v-1.5zm-.25-2.5c-.41 0-.75-.34-.75-.75s.34-.75.75-.75h6.5c.41 0 .75.34.75.75s-.34.75-.75.75H8.75z",transform:"scale(1.2) translate(-2 -2)",className:"jsx-6f1f93e81f1735bb"}),(0,s.jsx)("path",{d:"M3 11h18v2H3z",className:"jsx-6f1f93e81f1735bb"})]})})]}),(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb flex gap-1 items-center border-r border-gray-300 pr-2",children:[(0,s.jsx)("button",{onClick:c,type:"button",title:"Set Link",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("link")?"bg-gray-200":""),children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:[(0,s.jsx)("path",{d:"M17 7h-2v2h2v10H7V9h2V7H7c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM12 6c.83 0 1.5.67 1.5 1.5S12.83 9 12 9s-1.5-.67-1.5-1.5S11.17 6 12 6zm0-2c-1.93 0-3.5 1.57-3.5 3.5S10.07 11 12 11s3.5-1.57 3.5-3.5S13.93 4 12 4zm5-1h-2v2h2v2h2V7h2V5h-2V3h-2V5z",className:"jsx-6f1f93e81f1735bb"}),(0,s.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z",className:"jsx-6f1f93e81f1735bb"})]})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().unsetLink().run(),disabled:!o.isActive("link"),type:"button",title:"Unset Link",className:"jsx-6f1f93e81f1735bb p-2 rounded hover:bg-gray-200 disabled:opacity-50 disabled:hover:bg-transparent",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:[(0,s.jsx)("path",{d:"M17 7h-2v2h2v10H7V9h2V7H7c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zM12 6c.83 0 1.5.67 1.5 1.5S12.83 9 12 9s-1.5-.67-1.5-1.5S11.17 6 12 6zm0-2c-1.93 0-3.5 1.57-3.5 3.5S10.07 11 12 11s3.5-1.57 3.5-3.5S13.93 4 12 4zm5-1h-2v2h2v2h2V7h2V5h-2V3h-2V5z",className:"jsx-6f1f93e81f1735bb"}),(0,s.jsx)("path",{d:"M12.67 18.53c.38.38.99.38 1.37 0l4.05-4.05c.38-.38.38-.99 0-1.37l-4.05-4.05a.966.966 0 00-1.37 0L8.62 13.12a.966.966 0 000 1.37l4.05 4.04zm-1.06-9.9L15.5 4.75l-4.04 4.04-3.89-3.89-1.06 1.06 3.89 3.89-4.04 4.04 1.06 1.06 4.04-4.04 3.89 3.89 1.06-1.06-3.89-3.89 4.04-4.04z",className:"jsx-6f1f93e81f1735bb"})]})})]}),(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb flex gap-1 items-center border-r border-gray-300 pr-2",children:[(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleBulletList().run(),type:"button",title:"Bullet List",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("bulletList")?"bg-gray-200":""),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M8 4h13v2H8V4zm3 4h12v2H6V9zm-3 4h18v2H3v-2zm3 4h12v2H6v-2z",className:"jsx-6f1f93e81f1735bb"})})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleOrderedList().run(),type:"button",title:"Ordered List",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("orderedList")?"bg-gray-200":""),children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:[(0,s.jsx)("path",{d:"M7 5c0-.55-.45-1-1-1s-1 .45-1 1v2c0 .55.45 1 1 1s1-.45 1-1V5zm-1 6c-.55 0-1 .45-1 1v1c0 .55.45 1 1 1s1-.45 1-1v-1c0-.55-.45-1-1-1zm1 5c0-.55-.45-1-1-1s-1 .45-1 1v2c0 .55.45 1 1 1s1-.45 1-1v-2zm2-11h14v2H8V5zm0 6h14v2H8v-2zm0 6h14v2H8v-2z",transform:"scale(1.1) translate(-1 -1)",className:"jsx-6f1f93e81f1735bb"}),(0,s.jsx)("path",{d:"M2 17h2v.5H3v1h1V19H2v1h3v-4H2v1h1v3zm-1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 11.9V11H2v1zm18-10v2H8V3h12zm0 4H8v2h12V7zm0 4H8v2h12v-2z",className:"jsx-6f1f93e81f1735bb"})]})})]}),(0,s.jsxs)("div",{className:"jsx-6f1f93e81f1735bb flex gap-1 items-center",children:[(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleBlockquote().run(),type:"button",title:"Blockquote",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("blockquote")?"bg-gray-200":""),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3l-2 4zm8 0h3l2-4V7h-6v6h3l-2 4z",className:"jsx-6f1f93e81f1735bb"})})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleCode().run(),type:"button",title:"Inline Code",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("code")?"bg-gray-200":""),children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z",className:"jsx-6f1f93e81f1735bb"})})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().toggleCodeBlock().run(),type:"button",title:"Code Block",className:"jsx-6f1f93e81f1735bb "+"p-2 rounded hover:bg-gray-200 ".concat(o.isActive("codeBlock")?"bg-gray-200":""),children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:[(0,s.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4zM3 3h18v2H3V3zm0 16h18v2H3v-2z",transform:"scale(1.2) translate(-2 -2)",className:"jsx-6f1f93e81f1735bb"}),(0,s.jsx)("path",{d:"M4 5v14h16V5H4zm14 12H6V7h12v10zM8 9h8v2H8V9zm0 4h8v2H8v-2z",className:"jsx-6f1f93e81f1735bb"})]})}),(0,s.jsx)("button",{onClick:()=>o.chain().focus().setHorizontalRule().run(),type:"button",title:"Horizontal Rule",className:"jsx-6f1f93e81f1735bb p-2 rounded hover:bg-gray-200",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"currentColor",className:"jsx-6f1f93e81f1735bb",children:(0,s.jsx)("path",{d:"M3 11h18v2H3z",className:"jsx-6f1f93e81f1735bb"})})})]})]}),(0,s.jsx)(g.$Z,{editor:o,className:l}),(0,s.jsx)("div",{className:"jsx-6f1f93e81f1735bb text-xs text-gray-500 mt-2 px-2",children:"Tip: Use the toolbar for formatting. Paste bullet lists and headings for best results. For markdown paste support, please contact support for a custom extension."}),(0,s.jsx)(h(),{id:"6f1f93e81f1735bb",children:".ProseMirror{}.ProseMirror>*+*{margin-top:.75em}.ProseMirror ul,.ProseMirror ol{padding:0 1rem}.ProseMirror h1,.ProseMirror h2,.ProseMirror h3,.ProseMirror h4,.ProseMirror h5,.ProseMirror h6{line-height:1.1;margin-top:1.5em;margin-bottom:.75em}.ProseMirror p{margin:.5em 0}.ProseMirror ul{list-style:disc;margin-left:1.5rem}.ProseMirror ol{list-style:decimal;margin-left:1.5rem}.ProseMirror code{background-color:rgba(#616161, 0.1);-webkit-border-radius:.25em;-moz-border-radius:.25em;border-radius:.25em;padding:.25em}.ProseMirror img{max-width:100%;height:auto}.ProseMirror blockquote{padding-left:1rem;border-left:2px solid rgba(#0D0D0D, 0.1)}.ProseMirror hr{border:none;border-top:2px solid rgba(#0D0D0D, 0.1);margin:2rem 0}"})]}):(0,s.jsx)("div",{className:"p-4 border rounded-lg min-h-[200px]",children:"Loading editor..."})};var M=r(35299);let A=e=>e.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"").slice(0,50);function S(e){var t,r;let{post:m,onClose:h}=e,[g,u]=(0,a.useState)(!1),[f,b]=(0,a.useState)(null==m?void 0:m.featured_image),x=(0,i.createClientComponentClient)(),p=(0,o.jE)(),{data:v=[]}=(0,n.I)({queryKey:["blog-authors"],queryFn:async()=>{let{data:e}=await x.from("blog_authors").select("id, full_name").order("full_name");return e||[]}}),{data:j=[]}=(0,n.I)({queryKey:["blog-categories"],queryFn:async()=>{let{data:e}=await x.from("blog_categories").select("id, name, slug").order("name");return e||[]}}),{register:y,handleSubmit:w,formState:{errors:N},control:k,watch:C,setValue:z}=(0,l.mN)({defaultValues:{...m,status:(null==m?void 0:m.status)||"draft",author_id:(null==m?void 0:m.author_id)||(null==v||null==(t=v[0])?void 0:t.id)||""}});(0,a.useEffect)(()=>{!(v.length>0)||(null==m?void 0:m.author_id)||z("author_id",v[0].id)},[v,null==m?void 0:m.author_id,z]);let S=C("title");(0,a.useEffect)(()=>{!S||(null==m?void 0:m.slug)||z("slug",A(S))},[S,z,null==m?void 0:m.slug]);let V=(0,c.n)({mutationFn:async e=>{var t;let{categories:r,...s}=e,a=(null==m?void 0:m.id)||(0,d.A)(),{error:l}=(null==m?void 0:m.id)?await x.from("blog_posts").update({...s,updated_at:new Date().toISOString()}).eq("id",m.id):await x.from("blog_posts").insert({...s,id:a,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),author_id:null==(t=(await x.auth.getUser()).data.user)?void 0:t.id});if(l)throw l;if(r&&r.length>0){(null==m?void 0:m.id)&&await x.from("blog_posts_categories").delete().eq("post_id",m.id);let e=r.map(e=>({post_id:a,category_id:e})),{error:t}=await x.from("blog_posts_categories").insert(e);if(t)throw t}},onSuccess:()=>{p.invalidateQueries({queryKey:["blog-posts"]}),p.invalidateQueries({queryKey:["blog-posts-count"]}),h()},onError:e=>{}}),_=async e=>{try{u(!0),"published"===e.status&&(e.published_at=new Date().toISOString()),await V.mutateAsync(e),p.invalidateQueries()}catch(e){}finally{u(!1)}};return(0,s.jsxs)("form",{onSubmit:w(_),className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700",children:"Title *"}),(0,s.jsx)("input",{type:"text",id:"title",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",...y("title",{required:"Title is required"})}),N.title&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.title.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{htmlFor:"author_id",className:"block text-sm font-medium text-gray-700",children:"Author *"}),(0,s.jsx)("select",{id:"author_id",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm",...y("author_id",{required:"Author is required"}),children:v.map(e=>(0,s.jsx)("option",{value:e.id,children:e.full_name},e.id))}),N.author_id&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.author_id.message})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Slug"}),(0,s.jsx)("input",{type:"text",...y("slug",{required:"Slug is required"}),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary focus:outline-none"}),N.slug&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.slug.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Excerpt"}),(0,s.jsx)("textarea",{...y("excerpt",{required:"Excerpt is required"}),rows:2,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary focus:outline-none"}),N.excerpt&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.excerpt.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Content"}),(0,s.jsx)(l.xI,{name:"content",control:k,defaultValue:"",rules:{required:"Content is required"},render:e=>{let{field:t}=e;return(0,s.jsx)(H,{initialContent:t.value,onChange:t.onChange})}}),N.content&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:N.content.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Featured Image"}),(0,s.jsxs)("div",{className:"mt-2 space-y-4",children:[(0,s.jsx)(M.V,{bucket:"blog",onComplete:e=>{b(e),z("featured_image",e)},maxFiles:1,acceptedFileTypes:["image/jpeg","image/png","image/webp"]}),f&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:f,alt:"Featured",className:"h-48 w-full rounded-md object-cover",loading:"lazy"}),(0,s.jsx)("button",{type:"button",onClick:()=>{b(void 0),z("featured_image",void 0)},className:"absolute right-2 top-2 rounded-full bg-red-500 p-1 text-white hover:bg-red-600",children:"\xd7"})]})})]})]}),(0,s.jsxs)("div",{className:"space-y-4 rounded-lg border p-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"SEO Settings"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Meta Title"}),(0,s.jsx)("input",{type:"text",...y("meta_title"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary focus:outline-none"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Meta Description"}),(0,s.jsx)("textarea",{...y("meta_description"),rows:2,className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary focus:outline-none"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Categories"}),(0,s.jsx)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:j.map(e=>(0,s.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",value:e.id,...y("categories"),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,s.jsx)("span",{children:e.name})]},e.id))}),0===j.length&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"No categories available. Add categories in the Supabase dashboard."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Status"}),(0,s.jsxs)("select",{...y("status"),className:"mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-primary focus:outline-none",children:[(0,s.jsx)("option",{value:"draft",children:"Draft"}),(0,s.jsx)("option",{value:"published",children:"Published"})]})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-4 border-t pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:h,className:"rounded-md border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50",disabled:g,children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:g||V.isPending,className:"rounded-md bg-primary px-4 py-2 text-sm font-medium text-white hover:bg-primary-dark disabled:opacity-50",children:g?"Saving...":m?"Update Post":"Create Post"})]}),V.isError&&(0,s.jsxs)("p",{className:"text-sm text-red-600",children:["Error saving post: "," ",V.error instanceof Error?V.error.message:"object"==typeof V.error&&null!==V.error&&"message"in V.error?String(V.error.message):String(null!=(r=V.error)?r:"Unknown error")]})]})}}}]);